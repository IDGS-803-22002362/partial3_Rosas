{% extends "layout.html" %} {% import "_macros.html" as macros %} {# Importamos
el archivo de macros con un alias #} {% block container %}
<div class="container mx-auto p-6">
  <div class="flex justify-end">
    <h1 class="text-2xl font-bold text-gray-700 m-4">Las Picsas</h1>
  </div>
  <hr class="mb-8" />
  
  <!-- Formulario principal -->
  <form
    method="POST"
    action="{{ url_for('index') }}"
    class="space-y-4 bg-white p-4 rounded shadow"
  >
    {{ form.csrf_token }}

    <!-- Datos del Cliente -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
      {{ macros.render_text_field(form.nombre, 'border border-gray-300
      text-gray-900 rounded-lg w-full p-2.5') }} {{
      macros.render_text_field(form.direccion, 'border border-gray-300
      text-gray-900 rounded-lg w-full p-2.5') }} {{
      macros.render_text_field(form.telefono, 'border border-gray-300
      text-gray-900 rounded-lg w-full p-2.5') }} {{
      macros.render_text_field(form.fecha_pedido, 'border border-gray-300
      text-gray-900 rounded-lg w-full p-2.5') }}
    </div>

    <!-- Tamaño e Ingredientes -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- RadioField 'tamano' -->
      <div class="p-4 bg-gray-50 rounded-md shadow-inner">
        {{ macros.render_radio_field(form.tamano) }}
      </div>
      <!-- MultiCheckboxField 'ingredientes' -->
      <div class="p-4 bg-gray-50 rounded-md shadow-inner">
        {{ macros.render_checkbox_field(form.ingredientes) }}
      </div>
    </div>

    <!-- Cantidad y Botón Agregar -->
    <div class="flex items-end space-x-4">
      <div>
        {{ macros.render_text_field(form.cantidad, 'border border-gray-300
        text-gray-900 rounded-lg w-24 p-2.5') }}
      </div>
      <button
        type="submit"
        class="bg-blue-500 hover:bg-blue-600 text-white font-medium px-4 py-2 rounded-md shadow"
      >
        Agregar
      </button>
    </div>
  </form>

  <!-- Tabla de Detalle del Pedido -->
  <div class="mt-8 bg-white rounded-md shadow p-4">
    <h2 class="text-lg font-semibold text-gray-700 mb-4">Detalle del Pedido</h2>

    <!-- Botón Historial -->
    <a
      href="{{ url_for('historial') }}"
      class="text-gray-900 hover:text-white border border-gray-800 hover:bg-gray-900 focus:ring-4 focus:outline-none focus:ring-gray-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2 dark:border-gray-600 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-gray-800 flex items-center"
    >
      <svg
        class="w-6 h-6 text-gray-800 dark:text-white"
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        fill="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          fill-rule="evenodd"
          d="M5.617 2.076a1 1 0 0 1 1.09.217L8 3.586l1.293-1.293a1 1 0 0 1 1.414 0L12 3.586l1.293-1.293a1 1 0 0 1 1.414 0L16 3.586l1.293-1.293A1 1 0 0 1 19 3v18a1 1 0 0 1-1.707.707L16 20.414l-1.293 1.293a1 1 0 0 1-1.414 0L12 20.414l-1.293 1.293a1 1 0 0 1-1.414 0L8 20.414l-1.293 1.293A1 1 0 0 1 5 21V3a1 1 0 0 1 .617-.924ZM9 7a1 1 0 0 0 0 2h6a1 1 0 1 0 0-2H9Zm0 4a1 1 0 1 0 0 2h6a1 1 0 1 0 0-2H9Zm0 4a1 1 0 1 0 0 2h6a1 1 0 1 0 0-2H9Z"
          clip-rule="evenodd"
        />
      </svg>
      <span class="ml-2">Historial</span>
    </a>

    <div class="overflow-x-auto">
      <table class="w-full table-auto text-left">
        <thead class="bg-gray-100">
          <tr>
            <th class="py-2 px-4">Tamaño</th>
            <th class="py-2 px-4">Ingredientes Ext</th>
            <th class="py-2 px-4">Cantidad</th>
            <th class="py-2 px-4">SubTotal</th>
            <th class="py-2 px-4">Acción</th>
          </tr>
        </thead>
        <tbody>
          {% if pizzas %} {% for pizza in pizzas %}
          <tr class="border-b">
            <td class="py-2 px-4">{{ pizza.tamano }}</td>
            <td class="py-2 px-4">{{ pizza.ingredientes }}</td>
            <td class="py-2 px-4">{{ pizza.cantidad }}</td>
            <td class="py-2 px-4">$ {{ pizza.subtotal }}</td>
            <td class="py-2 px-4">
              <form
                action="{{ url_for('quitar') }}"
                method="POST"
                class="inline"
              >
                {{ form.csrf_token }}
                <input type="hidden" name="idx" value="{{ loop.index0 }}" />
                <button
                  type="submit"
                  class="bg-red-500 hover:bg-red-600 text-white font-medium px-3 py-1 rounded-md"
                >
                  Quitar
                </button>
              </form>
            </td>
          </tr>
          {% endfor %} {% else %}
          <tr>
            <td colspan="5" class="p-4 text-center text-gray-500">
              No hay pizzas agregadas.
            </td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </div>

    <!-- Terminar Pedido -->
    <div class="mt-4">
      <form action="{{ url_for('terminar') }}" method="POST">
        {{ form.csrf_token }}
        <input type="hidden" name="nombre" value="{{ form.nombre.data }}" />
        <input
          type="hidden"
          name="direccion"
          value="{{ form.direccion.data }}"
        />
        <input type="hidden" name="telefono" value="{{ form.telefono.data }}" />
        <input
          type="hidden"
          name="fecha_pedido"
          value="{{ form.fecha_pedido.data }}"
        />
        <button
          type="submit"
          class="bg-green-500 hover:bg-green-600 text-white font-medium px-4 py-2 rounded-md shadow"
        >
          Terminar
        </button>
      </form>
    </div>
  </div>
</div>
{% endblock %}
